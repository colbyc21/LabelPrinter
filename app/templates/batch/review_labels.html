{% extends "base.html" %}
{% block title %}Route {{ route }}{% if dept %} / {{ dept }}{% endif %} - Label Printer{% endblock %}
{% block content %}
<a href="{{ url_for('batch.select_route') }}" class="btn-back mb-3">&larr; Back to Routes</a>

<div class="page-header">
    <h2>Route {{ route }}{% if dept %} &mdash; Dept {{ dept }}{% else %} &mdash; All Departments{% endif %}</h2>
</div>

{% if customers %}
<form method="POST" action="{{ url_for('batch.print_labels') }}">
    <input type="hidden" name="route" value="{{ route }}">
    <input type="hidden" name="dept" value="{{ dept }}">

    <div class="toolbar">
        <button type="button" class="btn btn-outline-secondary" id="selectAll">Select All</button>
        <button type="button" class="btn btn-outline-secondary" id="deselectAll">Deselect All</button>
    </div>

    <div class="data-table mb-4">
        <table class="table table-sm mb-0">
            <thead>
                <tr>
                    <th style="width: 40px;"><input type="checkbox" id="checkAll" checked></th>
                    <th>Dept</th>
                    <th>Stop</th>
                    <th>Customer</th>
                    <th>Invoice</th>
                    <th>PO</th>
                    <th>Labels</th>
                </tr>
            </thead>
            <tbody>
                {% set ns = namespace(current_dept='') %}
                {% for c in customers %}
                {% if c.PICK_AREA != ns.current_dept %}
                {% set ns.current_dept = c.PICK_AREA %}
                <tr class="dept-header">
                    <td colspan="7">Department {{ c.PICK_AREA }}</td>
                </tr>
                {% endif %}
                <tr>
                    <td>
                        <input type="checkbox" name="selected" value="{{ loop.index0 }}" class="row-check" checked>
                    </td>
                    <td><span class="dept-badge">{{ c.PICK_AREA }}</span></td>
                    <td class="fw-600">{{ c.STOP }}</td>
                    <td>{{ c.CUSTOMER }}</td>
                    <td>{{ c.INVOICE_NO }}</td>
                    <td>{{ c.PO_NUM or '' }}</td>
                    <td>{{ c.LABELS or 1 }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <button type="submit" class="btn-print">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="6" y="2" width="12" height="6" rx="1"/><rect x="2" y="8" width="20" height="8" rx="1"/><rect x="6" y="16" width="12" height="6" rx="1"/><line x1="6" y1="11" x2="10" y2="11"/></svg>
        Print Selected Labels
    </button>
</form>

{% set has_20815 = customers | selectattr('CUSTOMER_NO', 'equalto', 20815) | list | length > 0 %}
{% if has_20815 %}
<form method="POST" action="{{ url_for('batch.print_pick_list') }}" class="mt-3">
    <input type="hidden" name="route" value="{{ route }}">
    <input type="hidden" name="dept" value="{{ dept }}">
    <button type="submit" class="btn btn-brand-outline">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><polyline points="10 9 9 9 8 9"/></svg>
        Print Pick Lists (Customer 20815)
    </button>
</form>
{% endif %}
{% else %}
<div class="empty-state">
    <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><line x1="8" y1="12" x2="16" y2="12"/></svg>
    <p>No orders found for this route.</p>
</div>
{% endif %}
{% endblock %}
